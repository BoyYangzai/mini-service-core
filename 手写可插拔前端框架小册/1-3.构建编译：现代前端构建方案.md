### 该小节主要知识点：
-   ⭐️ <span style="color: #ff502c;background-color: #fff5f5">模块化</span>的发展史
-   <span style="color: #ff502c;background-color: #fff5f5">Treeshaking</span> 基本原理
-   ⭐️ <span style="color: #ff502c;background-color: #fff5f5">Webpack、Rollup、Vite、Esbuild、Babel、Tsc、Swc</span> 有什么不同 ？
-   ⭐️ 什么是 <span style="color: #ff502c;background-color: #fff5f5">Bundle、Bundless、No-Bundle</span>？



## 给大家抛出一个问题：

>上一小节我们**使用 <span style="color: #ff502c;background-color: #fff5f5">tsc</span>** 将 我们的 **ts代码 全部 <span style="color: #ff502c;background-color: #fff5f5">转换</span>成了 js、js.map、d.ts的代码**<br>
>请问 这是 <span style="color: #ff502c;background-color: #fff5f5">打包</span> 吗？<span style="color: #ff502c;background-color: #fff5f5">为什么</span>？


在正式解答什么是 <span style="color: #ff502c;background-color: #fff5f5">Bundle、Bundless、No-Bundle</span> 之前，先带大家回顾一下模块化的<span style="color: #ff502c;background-color: #fff5f5">发展史</span>

## 模块化的发展史

在那个HTML文件里面写所有的JS、CSS代码，刀耕火种的年代，<span style="color: #ff502c;background-color: #fff5f5">工程化</span>逐渐兴起

优秀的前辈们开始了对 <span style="color: #ff502c;background-color: #fff5f5">工程化</span> 以及 <span style="color: #ff502c;background-color: #fff5f5">模块化</span> 的探索之路
  

### 一.无模块化标准阶段

#### 1.文件划分

问题：<span style="color: #ff502c;background-color: #fff5f5">命名冲突</span>，script<span style="color: #ff502c;background-color: #fff5f5">标签顺序管理困难</span>，变量全部<span style="color: #ff502c;background-color: #fff5f5">定义在全局</span>-调试困难

#### 2.命名空间

优化命名冲突：每个文件都是引入一个大的对象，解决了大对象下的变量命名冲突

#### 3.LIFE(<span style="color: #ff502c;background-color: #fff5f5">立即执行函数</span>)

目的是为了<span style="color: #ff502c;background-color: #fff5f5">解决变量命名冲突</span>

### 二.模块化标准阶段

#### 1.CJS-CommonJs

特点：只支持 <span style="color: #ff502c;background-color: #fff5f5">node</span> 环境，同步，导出变量<span style="color: #ff502c;background-color: #fff5f5">可以修改</span>

#### 2AMD(Asynchronous Module Definition，异步模块加载机制)

代表：requirejs

#### 3.CMD和UMD

CMD：与AMD一样解决异步问题

UMD：一直<span style="color: #ff502c;background-color: #fff5f5">兼容CJS和AMD</span>的方案

#### 4.ESM(浏览器原生和服务端支持异步)-<span style="color: #ff502c;background-color: #fff5f5">ESModule</span>

>在 node端 如何使用 ESModule呢？

##### 1.package.json中 type 改为 module

##### 2.文件名后缀为 <span style="color: #ff502c;background-color: #fff5f5">mjs</span>

特点：双端支持，异步，导出变量为引用，无法修改

>在 浏览器端 如何使用 ESModule呢

**script<span style="color: #ff502c;background-color: #fff5f5">标签中设置 type='module'</span> 即可**

## CJS与ESM的差异-- Treeshaking 基本原理

ESModule 模块依赖关系是<span style="color: #ff502c;background-color: #fff5f5">确定</span>的，和运行时的状态<span style="color: #ff502c;background-color: #fff5f5">无关</span>

可以进行可靠的⭐️ **<span style="color: #ff502c;background-color: #fff5f5">静态分析</span> 也就是 <span style="color: #ff502c;background-color: #fff5f5">不执行</span>里面的js代码 <span style="color: #ff502c;background-color: #fff5f5">就可以分析得到</span> 依赖图谱**

而 <span style="color: #ff502c;background-color: #fff5f5">CommonJs</span> **require <span style="color: #ff502c;background-color: #fff5f5">执行之后</span>** 我们 <span style="color: #ff502c;background-color: #fff5f5">才可以知道</span> 这个模块引用了其他的哪些模块
<br>



## Webpack、Rollup、Vite、Esbuild、Babel、Tsc、Swc 有什么不同
  

### 第一类叫做 Bundle 型

#### Webpack - <span style="color: #ff502c;background-color: #fff5f5">Bundle</span>

特点：

通过<span style="color: #ff502c;background-color: #fff5f5">构建依赖图谱</span> 最终将产物放到 <span style="color: #ff502c;background-color: #fff5f5">main.js</span> 中

对于除 js 之外的其他资源 bundle、transform 能力也同样优异

#### Rollup - <span style="color: #ff502c;background-color: #fff5f5">Bundle</span>

特点：

通过<span style="color: #ff502c;background-color: #fff5f5">构建依赖图谱</span> 最终将产物打包到 <span style="color: #ff502c;background-color: #fff5f5">main.js</span> 中

<span style="color: #ff502c;background-color: #fff5f5">大力支持ESModule</span>

### 第二类叫做 No-Bundle 型

#### Vite：

#### development 阶段：- <span style="color: #ff502c;background-color: #fff5f5">No-Bundle</span>

使用 ESbuild 对 ts、tsx、jsx 文件 进行 transform 进行<span style="color: #ff502c;background-color: #fff5f5">平行编译之后</span> 不Bundle

而是通过<span style="color: #ff502c;background-color: #fff5f5">浏览器原生支持 ESModule</span> 的特点，使用 <span style="color: #ff502c;background-color: #fff5f5">script标签</span> <span style="color: #ff502c;background-color: #fff5f5">type = ’module‘</span> 引入

#### production 阶段： - <span style="color: #ff502c;background-color: #fff5f5">Bundle</span>

使用<span style="color: #ff502c;background-color: #fff5f5">Rollup</span>进行<span style="color: #ff502c;background-color: #fff5f5">全量Bundle</span> 将产物打包到 <span style="color: #ff502c;background-color: #fff5f5">main.js</span> 种

### 第三类叫做 Bundless 型 有些开源库作者也喜欢叫 <span style="color: #ff502c;background-color: #fff5f5">Transform</span> 型

#### TSC - typescript compiler

#### Esbuild

#### Babel

#### Swc

他们的 <span style="color: #ff502c;background-color: #fff5f5">特点</span>是什么：<span style="color: #ff502c;background-color: #fff5f5">编译生成 js 代码</span>

比如我们上一小节中 将 ts 代码编译成了 js 代码

实际上 **上面四个都可以完成代码的<span style="color: #ff502c;background-color: #fff5f5">编译/转换</span>** 达到我们想要的效果

但是他们的能力 <span style="color: #ff502c;background-color: #fff5f5">仅限于</span> 例如 <span style="color: #ff502c;background-color: #fff5f5">ts js jsx tsx</span> ... 而<span style="color: #ff502c;background-color: #fff5f5">不包括其他资源</span>例如：css、图片、字体 ...

### 所以什么是Bundless？

<span style="color: #ff502c;background-color: #fff5f5">Bundless</span> 即<span style="color: #ff502c;background-color: #fff5f5">文件到文件</span>的构建模式，它不对依赖做任何处理，只对<span style="color: #ff502c;background-color: #fff5f5">源码</span>做<span style="color: #ff502c;background-color: #fff5f5">平行编译输出</span> -- (引自辟起老师)

以下是示例：

```
└── src
    ├── index.less
    ├── index.ts
    └── test.js
```

它会被编译成

```
└── src
    ├── index.d.ts
    ├── index.js
    ├── index.less
    └── test.js	
```

  


## 还记得本小节开头的问题吗？

上一小节我们**使用 <span style="color: #ff502c;background-color: #fff5f5">tsc</span>** 将 我们的 **ts代码 全部 <span style="color: #ff502c;background-color: #fff5f5">转换</span>成了 js、js.map、d.ts的代码**

请问这是 <span style="color: #ff502c;background-color: #fff5f5">打包</span> 吗？

答案是 -- <span style="color: #ff502c;background-color: #fff5f5">不是</span>

这是 <span style="color: #ff502c;background-color: #fff5f5">Bundless</span> 的方案

  


## 所以 什么是 Bundle、Bundless、No-Bundle？

相信你看到这里，对于三种模式已经有了自己的理解了 如果还是一知半解 建议<span style="color: #ff502c;background-color: #fff5f5">反复观看前面举的例子</span> 

### 总结一下：

**Bundle** 就是通过 <span style="color: #ff502c;background-color: #fff5f5">分析依赖图谱</span> **将所有文件<span style="color: #ff502c;background-color: #fff5f5">打入一个文件</span>** 里面去使用

**Bundless** 就是**只对 所有<span style="color: #ff502c;background-color: #fff5f5">源文件</span>** 进行 **<span style="color: #ff502c;background-color: #fff5f5">平行编译/transform</span> <span style="color: #ff502c;background-color: #fff5f5">不会去分析依赖关系</span>进行打包**

**No-Bundle** 例如**Vite** 就是 **利用<span style="color: #ff502c;background-color: #fff5f5">Bundless</span> <span style="color: #ff502c;background-color: #fff5f5">编译/transform</span> 之后**通过 <span style="color: #ff502c;background-color: #fff5f5">浏览器原生支持ESModule</span> 的特性使用 **script<span style="color: #ff502c;background-color: #fff5f5">标签</span>引入 <span style="color: #ff502c;background-color: #fff5f5">type = 'module'</span>** 做 development 开发

## 小结：

**本小节我们**

**1.首先带大家系统回顾了一下<span style="color: #ff502c;background-color: #fff5f5">模块化发展</span>的过程，引出了我们现在最常用的<span style="color: #ff502c;background-color: #fff5f5">CommonJs、ESModule、LIFE、UMD</span>等**

**2.主要介绍了这个 <span style="color: #ff502c;background-color: #fff5f5">Treeshaking</span> 优异的能力，它是通过 <span style="color: #ff502c;background-color: #fff5f5">ESModule</span> <span style="color: #ff502c;background-color: #fff5f5">静态分析</span> 的特点来实现的**

**3.通过举例当前工程化领域流行的几个工具，为大家介绍了他们的异同指出它们的<span style="color: #ff502c;background-color: #fff5f5">特点</span>，让大家自行体会<span style="color: #ff502c;background-color: #fff5f5">什么是Bundle、Bundless、No-Bundle</span>**

**4.总结了什么是Bundle、Bundless、No-Bundle，即 <span style="color: #ff502c;background-color: #fff5f5">Bundle</span>--通过 <span style="color: #ff502c;background-color: #fff5f5">分析依赖图谱 </span>将所有文件<span style="color: #ff502c;background-color: #fff5f5">打入一个文件</span>，<span style="color: #ff502c;background-color: #fff5f5">Bundless</span>--只对 所有<span style="color: #ff502c;background-color: #fff5f5">源文件</span>进行 <span style="color: #ff502c;background-color: #fff5f5">平行编译/transform</span> <span style="color: #ff502c;background-color: #fff5f5">不会去分析依赖关系</span>进行打包，<span style="color: #ff502c;background-color: #fff5f5">No-Bundle</span>--利用 <span style="color: #ff502c;background-color: #fff5f5">Bundless 编译/transform</span> 之后通过<span style="color: #ff502c;background-color: #fff5f5">浏览器原生支持ESModule</span>的特性使用 script<span style="color: #ff502c;background-color: #fff5f5">标签引入 type = 'module'</span>**

**下一小节将带着大家将我们的第一个 npm 包发布到 npm 仓库中 ~**

## 小节思考：

**你能自己表述出来 <span style="color: #ff502c;background-color: #fff5f5">什么是 Bundle、Bundless、No-Bundle</span> 吗？**
